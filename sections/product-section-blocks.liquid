{% assign objects = product.metafields.custom.product_section_blocks.value %}

{% if product.metafields.custom.product_section_blocks.value == blank and product.description == blank %}
    {% break %}
{% endif %}

<div
class="
    section
    {{ section.settings.section_padding }}
"
    style="--max-width: {{ section.settings.container_width | divided_by: 10 }}rem;"
>
    <div class="description-plain">
      {{ product.description }}
    </div>

    {% if product.media.size > 1 %}
      <div class="product-media-cascade {% if section.settings.enable_product_lightbox %} lightbox-media-container{% endif %}">
        {% for media in product.media %}
          {% unless forloop.first and product.media.size > 1%}
            <div class="product-section-block product-section-block-image">
                {%- capture image_sizes -%}
                    (min-width: 720px) calc(calc(50vw - calc(2 * clamp(18px, 3.3vw, 3.3vw)))), calc(100vw - calc(2 * 3.3vw))
                {%- endcapture -%}

                {%- capture media_link_element -%}
                  {%- if section.settings.enable_product_lightbox == true -%}
                      a
                  {%- else -%}
                      div
                  {%- endif -%}
                {%- endcapture -%}

                {% if section.settings.enable_product_lightbox == true %}
                  {%- capture media_atributes -%}
                      href="{{ media.src | image_url }}" class="lightbox-image no-transition"
                      data-pswp-src="{{- media.src | image_url -}}"
                      data-pswp-width="{{- media.width -}}"
                      data-pswp-height="{{ media.height }}"
                      data-cropped="true"
                  {%- endcapture -%}
                {%- endif -%}

                <{{ media_link_element }} {{ media_atributes }}>
                  {%- render 'image',
                      wrapper_class: 'section-block-product__image',
                      image: media,
                      aspect_ratio: 'natural',
                      sizes: image_sizes
                  -%}
                </{{ media_link_element }}>
            </div>
          {% endunless %}
        {% endfor %}
      </div>
    {% endif %}

    {% for item in objects %}
        {% case item.system.type %}
            {% when 'quote_product_section_block' %}
                {% if item.quote_content.value != blank %}
                    
                    {% liquid 
                        assign padding_top = blank
                        assign padding_bottom = blank
                        assign padding_top_mobile = blank
                        assign padding_bottom_mobile = blank

                        assign padding_top = item.padding_top | plus: 0
                        assign padding_bottom = item.padding_bottom | plus: 0

                        if item.padding_top_mobile != nil
                            assign padding_top_mobile = item.padding_top_mobile
                        endif

                        if item.padding_bottom_mobile != nil
                            assign padding_bottom_mobile = item.padding_bottom_mobile
                        endif
                    %}

                    <div class="product-section-block fs-heading-4-base aparajita-font" style="
                    --padding-top: {{ padding_top }}px;
                    --padding-bottom: {{ padding_bottom }}px;
                    line-height: 1.3em;
                    {% if padding_top_mobile != blank %}--padding-top-mobile: {{ padding_top_mobile }}px;{% endif %}
                    {% if padding_bottom_mobile != blank %}--padding-bottom-mobile: {{ padding_bottom_mobile }}px;{% endif %}">
                        {{ item.quote_content | metafield_tag }}
                    </div>
                {% endif %}
            {% when 'image_product_section_block' %}
                {% liquid 
                    assign padding_top = blank
                    assign padding_bottom = blank
                    assign padding_top_mobile = blank
                    assign padding_bottom_mobile = blank

                    assign padding_top = item.padding_top | plus: 0
                    assign padding_bottom = item.padding_bottom | plus: 0

                    if item.padding_top_mobile != nil
                        assign padding_top_mobile = item.padding_top_mobile
                    endif

                    if item.padding_bottom_mobile != nil
                        assign padding_bottom_mobile = item.padding_bottom_mobile
                    endif
                %}

                {% if item.image != blank %}
                    {% liquid

                        case item.image_aspect_ratio
                            when 'Adapt to image'
                                assign aspect_ratio = 'natural'
                            when 'Portrait (2:3)'
                                assign aspect_ratio = 'portrait'
                            when 'Square (1:1)'
                                assign aspect_ratio = 'square'
                            when 'Landscape (2:3)'
                                assign aspect_ratio = 'landscape'
                            else
                                assign aspect_ratio = 'natural'
                        endcase
                    %}

                    <div class="product-section-block product-section-block-image" style="
                        --padding-top: {{ padding_top }}px;
                        --padding-bottom: {{ padding_bottom }}px;
                      {% if padding_top_mobile != blank %}--padding-top-mobile: {{ padding_top_mobile }}px;{% endif %}
                      {% if padding_bottom_mobile != blank %}--padding-bottom-mobile: {{ padding_bottom_mobile }}px;{% endif %}"
                    >
                        {%- capture image_sizes -%}
                            (min-width: 720px) calc(calc(50vw - calc(2 * clamp(18px, 3.3vw, 3.3vw)))), calc(100vw - calc(2 * 3.3vw))
                        {%- endcapture -%}
                        {%- render 'image',
                            wrapper_class: 'section-block-product__image',
                            image: item.image.value,
                            aspect_ratio: aspect_ratio,
                            sizes: image_sizes
                        -%}
                    </div>
                {% endif %}
        {% endcase %}
    {% endfor %}
</div>


{% stylesheet %}
    .description-plain img {
      max-width: 100%;
      display: block;
    }

    .description-plain h3:has(em) {
      font-size: var(--font-size-heading-display-3);
      line-height: var(--line-height-heading);
      font-family: Aparajita, serif;
      font-style: italic;
      font-weight: 400;
      text-transform: unset;

      @media (max-width: 959px) {
        font-size: var(--font-size-heading-4-base);
      }
    }

    .product-media-cascade {
      margin-top: 52px;

      .product-section-block-image + .product-section-block-image {
        margin-top: 32px;
      }

      @media (max-width: 959px) {
        margin-top: 36px;
      }
    }

    .product-section-block {
        padding-top: var(--padding-top);
        padding-bottom: var(--padding-bottom);

        @media (max-width: 959px) {
            &[style*="--padding-top-mobile"] {
                padding-top: var(--padding-top-mobile);
            }

            &[style*="--padding-bottom-mobile"] {
              padding-bottom: var(--padding-bottom-mobile);
            }
        }
    }
{% endstylesheet %}

{% schema %}
{
  "name": "Product section blocks",
  "tag": "section",
  "disabled_on": {
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_product_lightbox",
      "label": "Enable zoom",
      "default": true
    },
    {
        "type": "range",
        "id": "container_width",
        "label": "Container width",
        "min": 500,
        "max": 1600,
        "step": 100,
        "default": 1200,
        "unit": "rem"
    },
    {
      "type": "header",
      "content": "t:shared.settings.section_style.header_style.content"
    },
    {
      "type": "select",
      "id": "divider_style",
      "label": "t:shared.settings.section_style.divider_style.label",
      "default": "none",
      "options": [
        {
          "label": "t:shared.settings.section_style.divider_style.option_none",
          "value": "none"
        },
        {
          "label": "t:shared.settings.section_style.divider_style.option_solid",
          "value": "solid"
        }
      ]
    },
    {
      "type": "select",
      "id": "section_padding",
      "label": "t:shared.settings.section_style.section_padding.label",
      "default": "section--vertical-padding-top-bottom",
      "options": [
        {
          "label": "t:shared.settings.section_style.section_padding.option_none",
          "value": "section--vertical-padding-none"
        },
        {
          "label": "t:shared.settings.section_style.section_padding.option_both",
          "value": "section--vertical-padding-top-bottom"
        },
        {
          "label": "t:shared.settings.section_style.section_padding.option_top",
          "value": "section--vertical-padding-top-only"
        },
        {
          "label": "t:shared.settings.section_style.section_padding.option_bottom",
          "value": "section--vertical-padding-bottom-only"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product section blocks"
    }
  ]
}
{% endschema %}